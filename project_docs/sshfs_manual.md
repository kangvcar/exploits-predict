## Manual for configure sshfs for store internal project database (sqlite) on remote server (e.g. VPS hosting).

Useful articles:
https://serverfault.com/questions/268977/how-can-i-create-a-user-only-for-sftp
https://tecadmin.net/how-to-create-sftp-only-user-in-ubuntu-22-04/

  

### On remote server:

1. Create user (username and password for sshfs_bot_username is store as SSHFS_USERNAME and SSHFS_PASSWORD in project .env)
```
sudo adduser --shell /bin/false sshfs_bot_username
```

3. Create dir for store database file (for the example below, the value of the DB_REMOTE_DIR variable in .env will be "/path_to_store_db/")

```
sudo mkdir -p /var/sshfs/path_to_store_db
sudo chown sshfs_bot_username:sshfs_bot_username /var/sshfs/path_to_store_db/
chown root:root /var/sshfs/
chmod 755 /var/sshfs
chown root:root /var/sshfs
chmod 755 /var/sshfs
```

4. Add configure to /etc/ssh/sshd_config
```
vim /etc/ssh/sshd_config
```

After:
```
# override default of no subsystems Subsystem sftp
/usr/lib/openssh/sftp-server_
```
Add:

```
# sshfs for project exploits-predict
Match User sshfs_bot_username
ForceCommand internal-sftp
PasswordAuthentication yes
ChrootDirectory /var/sshfs
PermitTunnel no
AllowAgentForwarding no
AllowTcpForwarding no
X11Forwarding no
```

6. Validate config file and restart sshd
```
sudo sshd -t
systemctl restart ssh
```
